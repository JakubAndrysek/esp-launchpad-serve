<html>
  <body>
    <script>
      (async () => {
        // Base paths for the GitHub Pages site
        const siteBasePath = '/esp-launchpad-serve';
        const baseUrl = 'https://jakubandrysek.github.io/esp-launchpad-serve/';

        // Get the current path, removing the site base path and leading/trailing slashes
        let currentPath = window.location.pathname.replace(siteBasePath, '').replace(/^\/|\/$/g, '');

        // If we're at root, don't add a path parameter
        const apiPath = currentPath ? `/${currentPath}` : '';

        const response = await fetch(`https://api.github.com/repos/JakubAndrysek/esp-launchpad-serve/contents${apiPath}`);
        const data = await response.json();

        let htmlString = '<h2>Directory listing for: /' + currentPath + '</h2><ul>';

        // Add parent directory link if not at root
        if (currentPath) {
          const parentPath = currentPath.split('/').slice(0, -1).join('/');
          const parentUrl = parentPath ? `${siteBasePath}/${parentPath}/` : `${siteBasePath}/`;
          htmlString += `<li><a href="${parentUrl}">.. (parent directory)</a></li>`;
        }

        for (let file of data) {
          const fileUrl = file.type === 'dir' ? `${baseUrl}${file.path}/` : `${baseUrl}${file.path}`;
          const displayName = file.type === 'dir' ? `${file.name}/` : file.name;
          htmlString += `<li><a href="${fileUrl}">${displayName}</a></li>`;
        }

        htmlString += '</ul>';
        document.getElementsByTagName('body')[0].innerHTML = htmlString;
      })()
    </script>
  </body>
</html>