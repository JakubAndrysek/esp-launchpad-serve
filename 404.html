<html>
  <head>
    <style>
      .file-content {
        background-color: #f5f5f5;
        border: 1px solid #ddd;
        padding: 10px;
        margin: 10px 0;
        white-space: pre-wrap;
        font-family: monospace;
        max-height: 500px;
        overflow-y: auto;
      }
      .back-button {
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <script>
      async function viewFile(downloadUrl, fileName) {
        try {
          const response = await fetch(downloadUrl);
          const content = await response.text();

          const htmlString = `
            <div class="back-button">
              <button onclick="location.reload()">‚Üê Back to directory listing</button>
            </div>
            <h2>File: ${fileName}</h2>
            <div class="file-content">${content}</div>
          `;

          document.getElementsByTagName('body')[0].innerHTML = htmlString;
        } catch (error) {
          alert('Error loading file: ' + error.message);
        }
      }
    </script>
    <script>
      (async () => {
        // Base paths for the GitHub Pages site
        const siteBasePath = '/esp-launchpad-serve';
        const baseUrl = 'https://jakubandrysek.github.io/esp-launchpad-serve/';

        // Get the current path, removing the site base path and leading/trailing slashes
        let currentPath = window.location.pathname.replace(siteBasePath, '').replace(/^\/|\/$/g, '');

        // If we're at root, don't add a path parameter
        const apiPath = currentPath ? `/${currentPath}` : '';

        const response = await fetch(`https://api.github.com/repos/JakubAndrysek/esp-launchpad-serve/contents${apiPath}`);
        const data = await response.json();

        let htmlString = '<h2>Directory listing for: /' + currentPath + '</h2><ul>';

        // Add parent directory link if not at root
        if (currentPath) {
          const parentPath = currentPath.split('/').slice(0, -1).join('/');
          const parentUrl = parentPath ? `${siteBasePath}/${parentPath}/` : `${siteBasePath}/`;
          htmlString += `<li><a href="${parentUrl}">.. (parent directory)</a></li>`;
        }

        for (let file of data) {
          const fileUrl = file.type === 'dir' ? `${baseUrl}${file.path}/` : `${baseUrl}${file.path}`;
          const displayName = file.type === 'dir' ? `${file.name}/` : file.name;

          if (file.type === 'dir') {
            htmlString += `<li><a href="${fileUrl}">${displayName}</a></li>`;
          } else {
            htmlString += `<li><a href="${fileUrl}">${displayName}</a> [<a href="#" onclick="viewFile('${file.download_url}', '${file.name}'); return false;">view</a>]</li>`;
          }
        }

        htmlString += '</ul>';
        document.getElementsByTagName('body')[0].innerHTML = htmlString;
      })()
    </script>
  </body>
</html>